<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>게시글 작성</title>

    <!-- Quill CSS -->
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">

    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f4f4f4;
            color: #333;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #fff;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        h1 {
            text-align: center;
            color: #555;
        }
        input[type="text"] {
            width: 100%;
            padding: 10px;
            margin-bottom: 15px;
            border: 1px solid #ccc;
            border-radius: 5px;
            box-sizing: border-box;
            font-size: 1em;
        }
        #editor {
            height: 300px;
            background-color: #fff;
        }
        .buttons {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 20px;
        }
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            text-decoration: none;
            text-align: center;
        }
        .write-btn {
            background-color: #5cb85c;
            color: white;
        }
        .write-btn:hover {
            background-color: #4cae4c;
        }
        .back-btn {
            background-color: #f0ad4e;
            color: white;
        }
        .back-btn:hover {
            background-color: #ec971f;
        }
    </style>
</head>
<body>

    <div class="container">
        <h1>게시글 작성</h1>

        <input type="text" placeholder="제목" id="title" required>
        <input type="text" placeholder="작성자" id="author" required>

        <!-- 에디터 영역 -->
        <div id="toolbar">
            <!-- 툴바 옵션 -->
            <span class="ql-formats">
                <button class="ql-bold"></button>
                <button class="ql-italic"></button>
                <button class="ql-underline"></button>
            </span>
            <span class="ql-formats">
                <button class="ql-image"></button>
                <button class="ql-video"></button>
            </span>
        </div>
        <div id="editor"></div>

        <div class="buttons">
            <a href="board.html" class="btn back-btn">목록으로</a>
            <button class="btn write-btn" id="saveBtn">작성</button>
        </div>
    </div>

    <!-- Quill JS -->
    <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
    <script>
    // indexedDB 초기화 및 DB 열기
    const DB_NAME = 'boardDB';
    const DB_VERSION = 1;
    const STORE_NAME = 'posts';

    let db;

    function openDB() {
        return new Promise((resolve, reject) => {
            const request = indexedDB.open(DB_NAME, DB_VERSION);

            request.onerror = () => reject('DB 열기 실패');
            request.onsuccess = (event) => {
                db = event.target.result;
                resolve(db);
            };

            request.onupgradeneeded = (event) => {
                db = event.target.result;
                if (!db.objectStoreNames.contains(STORE_NAME)) {
                    const objectStore = db.createObjectStore(STORE_NAME, { keyPath: 'id', autoIncrement: true });
                    objectStore.createIndex('title', 'title', { unique: false });
                    objectStore.createIndex('author', 'author', { unique: false });
                }
            };
        });
    }

    // 데이터 저장 함수
    function savePost(post) {
        return new Promise((resolve, reject) => {
            const transaction = db.transaction(STORE_NAME, 'readwrite');
            const store = transaction.objectStore(STORE_NAME);
            const request = store.add(post);

            request.onsuccess = () => resolve(request.result);
            request.onerror = () => reject('저장 실패');
        });
    }

    // 페이지 로드 시 DB 열기
    openDB().then(() => {
        console.log('DB 준비 완료');
    }).catch(console.error);

    // Quill 에디터 초기화
    const quill = new Quill('#editor', {
        modules: {
            toolbar: '#toolbar'
        },
        theme: 'snow'
    });

    // 작성 버튼 클릭 이벤트
    document.getElementById('saveBtn').addEventListener('click', async () => {
        const title = document.getElementById('title').value.trim();
        const author = document.getElementById('author').value.trim();
        const content = quill.root.innerHTML;

        if (!title || !author) {
            alert('제목과 작성자를 입력하세요.');
            return;
        }

        const post = {
            title,
            author,
            content,
            createdAt: new Date().toISOString()
        };

        try {
            const id = await savePost(post);
            alert(`작성 완료! 저장된 글 ID: ${id}`);
            // 저장 후 초기화 등 추가 동작 가능
            // 예: 입력 필드 초기화
            document.getElementById('title').value = '';
            document.getElementById('author').value = '';
            quill.setContents([]);
        } catch (error) {
            alert('저장 중 오류가 발생했습니다.');
            console.error(error);
        }
    });
    </script>

</body>
</html>
