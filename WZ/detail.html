<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>게시글 상세</title>
<style>
    /* 기존 스타일 유지 */
    body { font-family: Arial, sans-serif; margin: 20px; background:#f4f4f4; color:#333; }
    .container { max-width: 800px; margin: 0 auto; padding: 20px; background:#fff; box-shadow: 0 0 10px rgba(0,0,0,0.1);}
    .post-header { border-bottom: 2px solid #555; padding-bottom: 10px; margin-bottom: 20px; }
    .post-header h1 { margin: 0; font-size: 2em; }
    .post-meta { font-size: 0.9em; color: #888; margin-top: 5px; }
    .post-content { line-height: 1.6; margin-bottom: 30px; }
    .back-btn { display: inline-block; padding: 10px 20px; text-align: center; text-decoration: none; background: #5cb85c; color: white; border-radius: 5px; font-weight: bold; }
    .back-btn:hover { background: #4cae4c; }
</style>
</head>
<body>

<div class="container">
    <div class="post-header">
        <h1 id="postTitle">로딩 중...</h1>
        <div class="post-meta">
            <span class="author" id="postAuthor"></span>
            <span>|</span>
            <span class="date" id="postDate"></span>
        </div>
    </div>

    <div class="post-content" id="postContent">게시글 내용을 불러오는 중입니다.</div>

    <a href="board.html" class="back-btn">목록으로</a>
</div>

<script>
    const DB_NAME = 'boardDB';
    const DB_VERSION = 1;
    const STORE_NAME = 'posts';
    let db;

    function openDB() {
        return new Promise((resolve, reject) => {
            const request = indexedDB.open(DB_NAME, DB_VERSION);

            request.onerror = () => reject('DB 열기 실패');
            request.onsuccess = (e) => {
                db = e.target.result;
                resolve(db);
            };

            request.onupgradeneeded = (e) => {
                db = e.target.result;
                if (!db.objectStoreNames.contains(STORE_NAME)) {
                    db.createObjectStore(STORE_NAME, { keyPath: 'id', autoIncrement: true });
                }
            };
        });
    }

    function getPostById(id) {
        return new Promise((resolve, reject) => {
            const tx = db.transaction(STORE_NAME, 'readonly');
            const store = tx.objectStore(STORE_NAME);
            const request = store.get(Number(id));

            request.onsuccess = () => {
                if (request.result) resolve(request.result);
                else reject('게시글을 찾을 수 없습니다.');
            };
            request.onerror = () => reject('게시글 조회 실패');
        });
    }

    function formatDate(dateStr) {
        const d = new Date(dateStr);
        const yyyy = d.getFullYear();
        const mm = String(d.getMonth() + 1).padStart(2, '0');
        const dd = String(d.getDate()).padStart(2, '0');
        return `${yyyy}.${mm}.${dd}`;
    }

    // URL에서 쿼리파라미터 id 얻기
    const params = new URLSearchParams(window.location.search);
    const postId = params.get('id');

    if (!postId) {
        alert('잘못된 접근입니다.');
        window.location.href = 'board.html';
    }

    openDB()
    .then(() => getPostById(postId))
    .then(post => {
        document.getElementById('postTitle').textContent = post.title;
        document.getElementById('postAuthor').textContent = post.author;
        document.getElementById('postDate').textContent = formatDate(post.createdAt);
        // content가 HTML이라면 아래처럼 innerHTML 사용 가능
        // 만약 text라면 textContent로 변경 가능
        document.getElementById('postContent').innerHTML = post.content || '(내용 없음)';
    })
    .catch(err => {
        alert(err);
        window.location.href = 'board.html';
    });
</script>

</body>
</html>
